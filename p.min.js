(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{P=e()}})(function(){"use strict";var e={f:null,n:null},t=e,n=false,r,o,i=s(typeof window)&&window||s(typeof worker)&&worker,u={}.toString,f;function a(){while(e.n){e=e.n;var t=e.f;e.f=null;t()}n=false}var c=function(e){t=t.n={f:e,n:null};if(!n){n=true;o(a,0)}};function s(e){return e==="object"||e==="function"}function l(e){return e==="function"}if(l(typeof setImmediate)){o=i?function(e){i.setImmediate(e)}:function(e){setImmediate(e)}}else if(s(typeof process)&&process&&process.nextTick){o=process.nextTick}else if(l(typeof MessageChannel)){r=new MessageChannel;r.port1.onmessage=a;o=function(){r.port2.postMessage(0)}}else{o=setTimeout;if(i&&s(typeof Image)&&Image){(function(){var e=0;var t=function(e){var t=new Image;t.onerror=e;t.src="data:image/png,"};try{t(function(){if(--e===0){o=t}});++e}catch(n){}e&&setTimeout(function(){e=0},0)})()}}f=Array.isArray||function(e){return!!e&&u.call(e)==="[object Array]"};function p(e,t){for(var n=0,r=e.length;n<r;++n){if(n in e){t(e[n],n)}}}function v(e,t){if(f(e)){p(e,t);return}for(var n in e){t(e[n],n)}}function h(e){try{if(y.onerror){y.onerror(e)}else{throw e}}catch(t){setTimeout(function(){throw t},0)}}var m=0;var _=1;var d=2;function y(e){return e instanceof k?e:T(new k,e)}function w(e,t,n){if(e._state){return e}e._state=t;e._value=n;p(e._pending,c);e._pending=null;return e}function g(e,t){e._pending.push(t)}function T(e,t){if(e._state){return e}if(t instanceof k){if(t._state){w(e,t._state,t._value)}else{g(t,function(){w(e,t._state,t._value)})}}else if(t!==Object(t)){w(e,_,t)}else{c(function(){try{var n=t.then;if(typeof n==="function"){var r=j(e,t);n.call(t,r.resolve,r.reject)}else{w(e,_,t)}}catch(o){w(e,d,o)}})}return e}function j(e,t){var n=false;return{promise:e,resolve:function(r){if(!n){n=true;if(t&&t===r){w(e,_,r)}else{T(e,r)}}},reject:function(t){if(!n){n=true;w(e,d,t)}}}}y.defer=I;function I(){return j(new k)}function k(){this._state=0;this._value=void 0;this._pending=[]}k.prototype.then=function(e,t){var n=typeof e==="function"?e:null;var r=typeof t==="function"?t:null;var o=this;var i=new k;function u(){var e,t=o._state===_?n:r;if(t!==null){try{e=t(o._value)}catch(u){w(i,d,u);return}T(i,e)}else{w(i,o._state,o._value)}}if(o._state===m){g(o,u)}else{c(u)}return i};k.prototype.done=function(e,t){var n=this;if(e||t){n=n.then(e,t)}n.then(null,h)};k.prototype.fail=function(e){return this.then(null,e)};k.prototype.spread=function(e,t){return this.then(e&&function(t){return x(t).then(function(t){return e.apply(void 0,t)})},t)};k.prototype.timeout=function(e,t){var n=this;var r=new k;if(n._state!==m){w(r,n._state,n._value)}else{var o=setTimeout(function(){w(r,d,new Error(t||"Timed out after "+e+" ms"))},e);g(n,function(){clearTimeout(o);w(r,n._state,n._value)})}return r};k.prototype.delay=function(e){var t=this;var n=new k;setTimeout(function(){T(n,t)},e);return n};y.all=x;function x(e){var t=0;var n=I();v(e,function(r,o){var i=y(r);if(i._state===m){++t;i.then(function(r){e[o]=r;if(--t===0){n.resolve(e)}},n.reject)}else{e[o]=i._value}});if(t===0){n.resolve(e)}return n.promise}y.onerror=null;y.nextTick=function(e){c(function(){try{e()}catch(t){setTimeout(function(){throw t},0)}})};y._each=v;return y});