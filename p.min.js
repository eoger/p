(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define!=="function"){define(e)}else{P=e()}})(function(){"use strict";var e={f:null,w:false,n:null},n=e,t=true,r=0,f=0,o,i,u=s(typeof window)&&window||s(typeof worker)&&worker;function c(){--r;while(e.n){e=e.n;if(e.w){--f}var n=e.f;e.f=null;n()}t=true}function l(e,o){if(t&&++f>r){++r;i(c,0)}n=n.n={f:e,w:t,n:null};t=o===true}function s(e){return e==="object"||e==="function"}function p(e){return e==="function"}if(s(typeof process)&&process&&p(typeof process.nextTick)){i=process.nextTick}else if(u&&p(typeof u.setImmediate)){i=function(e){u.setImmediate(e)}}else if(p(typeof MessageChannel)){o=new MessageChannel;o.port1.onmessage=c;i=function(){o.port2.postMessage(0)}}else{i=setTimeout;if(u&&s(typeof Image)&&Image){(function(){var e=0;var n=function(e){var n=new Image;n.onerror=e;n.src="data:image/png,"};try{n(function(){if(--e===0){i=n}});++e}catch(t){}e&&setTimeout(function(){e=0},0)})()}}function a(e,n){for(var t=0,r=e.length;t<r;++t){n(e[t],t)}}var h=v;h.prototype=y.prototype;h.defer=m;function m(){var e=[],n=false,t;function r(r,f){var o=m();function i(){var e=n?f:r;if(typeof e!=="function"){if(n){o.reject(t)}else{o.fulfill(t)}}else{var i;try{i=e(t);if(i&&typeof i.then==="function"){i.then(o.fulfill,o.reject);return}}catch(u){o.reject(u)}o.fulfill(i)}}if(e){e.push(i)}else{l(i)}return o.promise}function f(n){if(e){t=n;a(e,l);e=null}}function o(t){if(e){n=true;f(t)}}return{promise:new y(r),fulfill:f,reject:o}}function y(e){this.then=e}y.prototype.done=function(e,n){var t=this;if(e||n){t=t.then(e,n)}t.then(null,function(e){l(function(){if(h.onerror){h.onerror(e)}else{throw e}},true)})};y.prototype.spread=function(e,n){return this.then(e&&function(n){return e.apply(void 0,n)},n)};h.resolve=v;function v(e){if(e instanceof y){return e}var n=m();if(e&&typeof e.then==="function"){e.then(n.fulfill,n.reject)}else{n.fulfill(e)}return n.promise}h.reject=d;function d(e){var n=m();n.reject(e);return n.promise}h.all=w;function w(e){var n=0;var t=m();a(e,function(r,f){if(f in e){++n;v(r).then(function(r){e[f]=r;if(--n===0){t.fulfill(e)}},t.reject)}});if(n===0){t.fulfill(e)}return t.promise}h.promise=function(e){var n=m();v(e).then(function(e){try{e(n.fulfill,n.reject)}catch(t){n.reject(t)}},n.reject);return n.promise};h.onerror=null;h.nextTick=function(e){l(e,true)};return h});