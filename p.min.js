(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{P=e()}})(function(){"use strict";var e={f:null,w:false,n:null},n=e,t=true,r=0,o=0,i,f,u=v(typeof window)&&window||v(typeof worker)&&worker,c=e.toString,s,a={};function l(){--r;if(e.n){if(!r&&e.n.n){++r;f(l,0)}do{e=e.n;if(e.w){--o}var n=e.f;e.f=null;n()}while(e.n)}t=true}var p=function(e,i){if(t&&++o>r){++r;f(l,0)}n=n.n={f:e,w:t,n:null};t=i===true};function v(e){return e==="object"||e==="function"}function m(e){return e==="function"}if(v(typeof process)&&process&&m(typeof process.nextTick)){f=process.nextTick}else if(u&&m(typeof u.setImmediate)){f=function(e){u.setImmediate(e)}}else if(m(typeof MessageChannel)){i=new MessageChannel;i.port1.onmessage=l;f=function(){i.port2.postMessage(0)}}else{f=setTimeout;if(u&&v(typeof Image)&&Image){(function(){var e=0;var n=function(e){var n=new Image;n.onerror=e;n.src="data:image/png,"};try{n(function(){if(--e===0){f=n}});++e}catch(t){}e&&setTimeout(function(){e=0},0)})()}}function y(e){p(function(){if(g.onerror){g.onerror(e)}else{throw e}},true)}function d(e,n){var t=n.t;return function(r,o,i){if(t===n.t){++n.t;e(r,o,i)}}}s=Array.isArray||function(e){return!!e&&c.call(e)==="[object Array]"};function h(e,n){for(var t=0,r=e.length;t<r;++t){if(t in e){n(e[t],t)}}}function w(e,n){if(s(e)){h(e,n);return}for(var t in e){n(e[t],t)}}function g(e){if(e instanceof j){return e}var n=T();n.resolve(e);return n.promise}g.defer=T;function T(){var e=[],n={t:0},t=false,r;function o(n,o,i,f){var u=i===a?void 0:T();function c(){var e=t?n:o;if(typeof e==="function"){try{var i=e(r)}catch(f){u?u.reject(f):y(f);return}u&&u.resolve(i)}else if(u){u.resolve(r,a,t)}else if(!t){y(r)}}if(e){e.push(c)}else if(!u&&f){c()}else{p(c)}return u&&u.promise}function i(o,c,s){if(e){if(c===a){t=!!s;r=o;h(e,p);e=null}else if(o instanceof j){o.then(f,u,a,true)}else if(o===Object(o)){p(function(){try{var e=o.then;if(typeof e==="function"){e.call(o,d(i,n),d(u,n))}else{f(o)}}catch(t){u(t)}})}else{f(o)}}}function f(e){i(e,a,true)}function u(e){i(e,a,false)}return{promise:new j(o),resolve:d(i,n),reject:d(u,n)}}function j(e){this.then=e}j.prototype.done=function(e,n){this.then(e,n,a)};j.prototype.spread=function(e,n){return this.then(e&&function(n){return k(n).then(function(n){return e.apply(void 0,n)})},n)};j.prototype.timeout=function(e){var n=T();var t=setTimeout(function(){n.reject(new Error("Timed out after "+e+" ms"))},e);this.then(function(e){clearTimeout(t);n.resolve(e)},function(e){clearTimeout(t);n.reject(e)},a,true);return n.promise};j.prototype.delay=function(e){var n=this;var t=T();setTimeout(function(){t.resolve(n)},e);return t.promise};g.all=k;function k(e){var n=0;var t=T();w(e,function(r,o){++n;g(r).then(function(r){e[o]=r;if(--n===0){t.resolve(e)}},t.reject,a)});if(n===0){t.resolve(e)}return t.promise}g.onerror=null;g.prototype=j.prototype;g.nextTick=function(e){p(e,true)};g._each=w;return g});