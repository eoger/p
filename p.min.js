(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{P=e()}})(function(){"use strict";var e=d(typeof process)&&process!=null&&{}.toString.call(process)==="[object process]",t=typeof setImmediate==="function",n=d(typeof MutationObserver)&&MutationObserver||d(typeof WebKitMutationObserver)&&WebKitMutationObserver,r={f:null,n:null},i=r,o=false,u=e?y:n?w(m):g(m),f=[],a=g(h),c,s,l,v=d.call,p=d.apply;function d(e){return e==="object"||e==="function"}function h(){if(f.length){throw f.shift()}}function m(){while(r.n){r=r.n;var e=r.f;r.f=null;e.call()}o=false}var _=function(e){i=i.n={f:e,n:null};if(!o){o=true;u()}};function y(){var e=process.domain;if(e){if(!l)l=(1,require)("domain");l.active=process.domain=null}if(o&&t){setImmediate(m)}else{process.nextTick(m)}if(e){l.active=process.domain=e}}function w(e){var t=1;var r=document.createTextNode("");var i=new n(e);i.observe(r,{characterData:true});return function(){t=-t;r.data=t}}function g(e){return function(){var t=setTimeout(r,0);var n=setInterval(r,50);function r(){clearTimeout(t);clearInterval(n);e()}}}if(e){c=function(e){var t=process.domain;return function(){if(t){if(t._disposed)return;t.enter()}try{e.call()}catch(n){u();throw n}if(t){t.exit()}}};s=function(e){var t=process.domain;_(!t?e:function(){if(!t._disposed){t.enter();e.call();t.exit()}})}}else{c=function(e){return function(){try{e.call()}catch(t){f.push(t);a()}}};s=_}function T(e){_(c(e))}function b(e,t){for(var n=0,r=e.length;n<r;++n){if(n in e){t(e[n],n)}}}function j(e){T(function(){if(M.onerror){M.onerror.call(null,e)}else{throw e}})}var x=0;var O=1;var I=2;function M(e){return e instanceof N?e:S(new N,e)}function E(t,n,r,i){if(t._state){return t}t._state=n;t._value=r;if(i){t._domain=i}else if(e&&n===I){t._domain=process.domain}if(t._pending.length){b(t._pending,_)}t._pending=null;return t}function k(e,t){e._pending.push(t)}function K(e,t){E(t,e._state,e._value,e._domain)}function S(e,t){if(e._state){return e}if(t instanceof N){if(t===e){E(e,I,new TypeError("You can't resolve a promise with itself"))}else if(t._state){K(t,e)}else{k(t,function(){K(t,e)})}}else if(t!==Object(t)){E(e,O,t)}else{s(function(){var n=W(e);try{var r=t.then;if(typeof r==="function"){v.call(r,t,n.resolve,n.reject)}else{E(e,O,t)}}catch(i){n.reject(i)}})}return e}function W(e){var t=false;return{promise:e,resolve:function(n){if(!t){t=true;S(e,n)}},reject:function(n){if(!t){t=true;E(e,I,n)}}}}M.defer=q;function q(){return W(new N)}M.reject=D;function D(e){return E(new N,I,e)}function N(){this._state=0;this._value=void 0;this._domain=null;this._pending=[]}N.prototype.then=function(t,n){var r=typeof t==="function"?t:null;var i=typeof n==="function"?n:null;var o=this;var u=new N;var f=e&&process.domain;function a(){var e=o._state===O?r:i;if(!e){K(o,u);return}var t,n=false;var a=o._domain||f;if(a){if(a._disposed)return;a.enter()}try{t=e(o._value)}catch(c){n=true;E(u,I,c)}if(!n){S(u,t)}if(a){a.exit()}}if(o._state===x){k(o,a)}else{_(a)}return u};N.prototype.done=function(e,t){var n=this;if(e||t){n=n.then(e,t)}n.then(null,j)};N.prototype.fail=function(e){return this.then(null,e)};N.prototype.spread=function(e,t){return this.then(e&&function(n){return z(n,[]).then(function(t){return p.call(e,void 0,t)},t)},t)};N.prototype.timeout=function(e,t){var n=this;var r=new N;if(n._state!==x){K(n,r)}else{var i=setTimeout(function(){E(r,I,new Error(t||"Timed out after "+e+" ms"))},e);k(n,function(){clearTimeout(i);K(n,r)})}return r};N.prototype.delay=function(e){var t=q();this.then(function(n){setTimeout(function(){t.resolve(n)},e)},t.reject);return t.promise};N.prototype.inspect=function(){switch(this._state){case x:return{state:"pending"};case O:return{state:"fulfilled",value:this._value};case I:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}};function P(e){function t(t){return e(t,[])}function n(e){return M(e).then(t)}n._=e;return n}M.allSettled=P(Y);function Y(e,t){var n=0;var r=new N;b(e,function(e,i){var o=M(e);if(o._state===x){++n;k(o,function(){t[i]=o.inspect();if(--n===0){E(r,O,t)}})}else{t[i]=o.inspect()}});if(n===0){E(r,O,t)}return r}M.all=P(z);function z(e,t){var n=0;var r=q();b(e,function(e,i){var o=M(e);if(o._state===O){t[i]=o._value}else{++n;o.then(function(e){t[i]=e;if(--n===0){r.resolve(t)}},r.reject)}});if(n===0){r.resolve(t)}return r.promise}M.promised=A;function A(e){function t(t){return p.apply(e,t)}return function(){var e=z(arguments,[]);return z([this,e],[]).then(t)}}M.onerror=null;M.nextTick=T;return M});