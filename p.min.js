(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{P=e()}})(function(){"use strict";var e=v(typeof process)&&process!=null&&{}.toString.call(process)==="[object process]",n=typeof setImmediate==="function",t=v(typeof MutationObserver)&&MutationObserver||v(typeof WebKitMutationObserver)&&WebKitMutationObserver,i=new d,r=i,o=false,u=e?w:t?g(_):x(_),a=[],l=x(h),s,f,c=v.call,p=v.apply;r.next=i;function d(){this.task=null;this.domain=null;this.a=null;this.b=null;this.next=null}function v(e){return e==="object"||e==="function"}function h(){if(a.length){throw a.shift()}}function _(){while(i!==r){i=i.next;var e=i.task;if(i.domain){y(i.domain,e,i.a,i.b,void 0);i.domain=null}else{e(i.a,i.b)}i.task=null;i.a=null;i.b=null}o=false}function m(){i.task=null;i.domain=null;i.a=null;i.b=null;u()}function y(e,n,t,i,r){if(e._disposed){return}e.enter();n(t,i,r);e.exit()}function b(n,t,a,l){var s=r.next;if(s===i){s=new d;r.next=s;s.next=i}r=s;s.task=t;s.a=a;s.b=l;if(n&&e){s.domain=process.domain}if(!o){o=true;u()}}function w(){var e=process.domain;if(e){if(!f)f=(1,require)("domain");f.active=process.domain=null}if(o&&n){setImmediate(_)}else{process.nextTick(_)}if(e){f.active=process.domain=e}}function g(e){var n=1;var i=document.createTextNode("");var r=new t(e);r.observe(i,{characterData:true});return function(){n=-n;i.data=n}}function x(e){return function(){var n=setTimeout(i,0);var t=setInterval(i,50);function i(){clearTimeout(n);clearInterval(t);e()}}}if(e){s=function(e){m();throw e}}else{s=function(e){a.push(e);l()}}function T(e,n){try{e.call()}catch(t){n(t)}}function j(e){b(true,T,e,s)}function k(e,n){for(var t=0,i=e.length;t<i;++t){if(t in e){n(e[t],t)}}}function O(e){j(function(){if(A.onerror){A.onerror.call(null,e)}else{throw e}})}var I=0;var M=1;var E=2;function A(e){return e instanceof F?e:W(new F,e)}function K(n,t,i){if(n._state){return n}n._state=t;n._value=i;if(t===E&&e){n._domain=process.domain}if(n._pending){D(n)}return n}function S(e,n){if(n._state){return n}n._state=e._state;n._value=e._value;n._domain=e._domain;if(n._pending){D(n)}return n}function W(e,n,t){if(e._state){return e}if(n instanceof F){if(n===e){K(e,E,new TypeError("You can't resolve a promise with itself"))}else if(n._state){S(n,e)}else{N(e,n)}}else if(n!==Object(n)){K(e,M,n)}else if(t){q(e,n)}else{b(true,q,e,n)}return e}function q(e,n){var t,i;try{i=n.then}catch(r){K(e,E,r);return}if(typeof i==="function"){t=z(e);try{c.call(i,n,t.resolve,t.reject)}catch(o){t.reject(o)}}else{K(e,M,n)}}function D(e){var n=e._pending;e._pending=null;if(n instanceof F){b(false,P,e,n);return}for(var t=0,i=n.length;t<i;++t){b(false,P,e,n[t])}}function N(e,n){if(!n._pending){n._pending=e}else if(n._pending instanceof F){n._pending=[n._pending,e]}else{n._pending.push(e)}}function P(e,n){var t=e._state===M?n._cb:n._eb;n._cb=null;n._eb=null;if(!t){S(e,n);return}var i=e._domain||n._domain;if(i){n._domain=null;y(i,Y,t,n,e._value)}else{Y(t,n,e._value)}}function Y(e,n,t){var i;try{i=e(t)}catch(r){K(n,E,r);return}W(n,i,true)}function z(e){var n=false;return{promise:e,resolve:function(t){if(!n){n=true;W(e,t,false)}},reject:function(t){if(!n){n=true;K(e,E,t)}}}}A.defer=B;function B(){return z(new F)}A.reject=C;function C(e){return K(new F,E,e)}function F(){this._state=0;this._value=void 0;this._domain=null;this._cb=null;this._eb=null;this._pending=null}F.prototype.then=function(n,t){var i=new F;i._cb=typeof n==="function"?n:null;i._eb=typeof t==="function"?t:null;i._domain=e?process.domain:null;if(this._state===I){N(i,this)}else{b(false,P,this,i)}return i};F.prototype.done=function(e,n){var t=this;if(e||n){t=t.then(e,n)}t.then(null,O)};F.prototype.fail=function(e){return this.then(null,e)};F.prototype._always=function(e){return this.then(e,e)};F.prototype.spread=function(e,n){return this.then(e&&function(t){return H(t).then(function(n){return p.call(e,void 0,n)},n)},n)};F.prototype.timeout=function(e,n){var t=this;var i=new F;if(t._state!==I){S(t,i)}else{var r=setTimeout(function(){K(i,E,new Error(n||"Timed out after "+e+" ms"))},e);t._always(function(){clearTimeout(r);S(t,i)})}return i};F.prototype.delay=function(e){var n=B();this.then(function(t){setTimeout(function(){n.resolve(t)},e)},n.reject);return n.promise};F.prototype.inspect=function(){switch(this._state){case I:return{state:"pending"};case M:return{state:"fulfilled",value:this._value};case E:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}};A.allSettled=G;function G(e){var n=0;var t=new F;var i=new Array(e.length);k(e,function(e,r){var o=A(e);if(o._state===I){++n;o._always(function(){i[r]=o.inspect();if(--n===0){K(t,M,i)}})}else{i[r]=o.inspect()}});if(n===0){K(t,M,i)}return t}A.all=H;function H(e){var n=0;var t=B();var i=new Array(e.length);k(e,function(e,r){var o=A(e);if(o._state===M){i[r]=o._value}else{++n;o.then(function(e){i[r]=e;if(--n===0){t.resolve(i)}},t.reject)}});if(n===0){t.resolve(i)}return t.promise}A.promised=J;function J(e){function n(n){return p.apply(e,n)}return function(){return H([this,H(arguments)]).then(n)}}A.onerror=null;A.nextTick=j;return A});