(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define!=="function"){define(e)}else{P=e()}})(function(){"use strict";var e={f:null,w:false,n:null},n=e,t=true,o=0,r=0,i,f,u=p(typeof window)&&window||p(typeof worker)&&worker,l=e.toString,c;function s(){--o;while(e.n){e=e.n;if(e.w){--r}var n=e.f;e.f=null;n()}t=true}function a(e,i){if(t&&++r>o){++o;f(s,0)}n=n.n={f:e,w:t,n:null};t=i===true}function p(e){return e==="object"||e==="function"}function v(e){return e==="function"}if(p(typeof process)&&process&&v(typeof process.nextTick)){f=process.nextTick}else if(u&&v(typeof u.setImmediate)){f=function(e){u.setImmediate(e)}}else if(v(typeof MessageChannel)){i=new MessageChannel;i.port1.onmessage=s;f=function(){i.port2.postMessage(0)}}else{f=setTimeout;if(u&&p(typeof Image)&&Image){(function(){var e=0;var n=function(e){var n=new Image;n.onerror=e;n.src="data:image/png,"};try{n(function(){if(--e===0){f=n}});++e}catch(t){}e&&setTimeout(function(){e=0},0)})()}}c=Array.isArray||function(e){return!!e&&l.call(e)==="[object Array]"};function d(e,n){for(var t=0,o=e.length;t<o;++t){if(t in e){n(e[t],t)}}}function h(e,n){if(c(e)){d(e,n);return}for(var t in e){n(e[t],t)}}function m(e){if(e instanceof w){return e}var n=y();n.resolve(e);return n.promise}m.defer=y;function y(){var e=[],n=false,t=new w(r),o;function r(t,r){var i=y();function f(){var e=n?r:t;if(typeof e==="function"){try{i.resolve(e(o))}catch(f){i.reject(f)}}else if(n){i.reject(o)}else{i.fulfill(o)}}if(e){e.push(f)}else{a(f)}return i.promise}function i(n){if(e){if(n&&typeof n.then==="function"){n.then(f,u)}else{f(n)}}}function f(r){if(e){t.state=n?"rejected":"fulfilled";t.value=o=r;d(e,a);e=null}}function u(t){if(e){n=true;f(t)}}return{promise:t,resolve:i,fulfill:f,reject:u}}function w(e){this.then=e;this.state="pending";this.value=void 0}w.prototype.done=function(e,n){var t=this;if(e||n){t=t.then(e,n)}t.then(null,function(e){a(function(){if(m.onerror){m.onerror(e)}else{throw e}},true)})};w.prototype.spread=function(e,n){return this.then(e&&function(n){return e.apply(void 0,n)},n)};m.all=g;function g(e){var n=0;var t=y();h(e,function(o,r){++n;m(o).then(function(o){e[r]=o;if(--n===0){t.fulfill(e)}},t.reject)});if(n===0){t.fulfill(e)}return t.promise}m.allResolved=j;function j(e){var n=1;var t=y();function o(){if(--n===0){t.fulfill(promise)}}h(e,function(t,r){++n;e[r]=t=m(t);t.then(o,o)});o();return t.promise}m.onerror=null;m.prototype=w.prototype;m.nextTick=function(e){a(e,true)};return m});