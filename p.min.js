(function(e){if(typeof module!=="undefined"&&module&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{P=e()}})(function(){"use strict";var e={f:null,n:null},t=e,n=false,r,i,o=p(typeof window)&&window||p(typeof worker)&&worker,u={}.toString,f,a=p.call,s=p.apply;function c(){while(e.n){e=e.n;var t=e.f;e.f=null;t()}n=false}var l=function(e){t=t.n={f:e,n:null};if(!n){n=true;i(c,0)}};function p(e){return e==="object"||e==="function"}function v(e){return e==="function"}if(p(typeof process)&&process&&process.nextTick){i=process.nextTick}else if(v(typeof setImmediate)){i=o?function(e){o.setImmediate(e)}:function(e){setImmediate(e)}}else if(v(typeof MessageChannel)){r=new MessageChannel;r.port1.onmessage=c;i=function(){r.port2.postMessage(0)}}else{i=setTimeout;if(o&&p(typeof Image)&&Image){(function(){var e=0;var t=function(e){var t=new Image;t.onerror=e;t.src="data:image/png,"};try{t(function(){if(--e===0){i=t}});++e}catch(n){}e&&setTimeout(function(){e=0},0)})()}}f=Array.isArray||function(e){return!!e&&u.call(e)==="[object Array]"};function h(e,t){for(var n=0,r=e.length;n<r;++n){if(n in e){t(e[n],n)}}}function d(e){try{if(w.onerror){w.onerror(e)}else{throw e}}catch(t){setTimeout(function(){throw t},0)}}var _=0;var m=1;var y=2;function w(e){return e instanceof x?e:j(new x,e)}function g(e,t,n){if(e._state){return e}e._state=t;e._value=n;if(e._pending.length>0){h(e._pending,l)}e._pending=null;return e}function T(e,t){e._pending.push(t)}function j(e,t){if(e._state){return e}if(t instanceof x){if(t._state){g(e,t._state,t._value)}else{T(t,function(){g(e,t._state,t._value)})}}else if(t!==Object(t)){g(e,m,t)}else{l(function(){try{var n=t.then;if(typeof n==="function"){var r=I(e,t);a.call(n,t,r.resolve,r.reject)}else{g(e,m,t)}}catch(i){g(e,y,i)}})}return e}function I(e,t){var n=false;return{promise:e,resolve:function(r){if(!n){n=true;if(t&&t===r){g(e,m,r)}else{j(e,r)}}},reject:function(t){if(!n){n=true;g(e,y,t)}}}}w.defer=k;function k(){return I(new x)}function x(){this._state=0;this._value=void 0;this._pending=[]}x.prototype.then=function(e,t){var n=typeof e==="function"?e:null;var r=typeof t==="function"?t:null;var i=this;var o=new x;function u(){var e,t=i._state===m?n:r;if(t!==null){try{e=t(i._value)}catch(u){g(o,y,u);return}j(o,e)}else{g(o,i._state,i._value)}}if(i._state===_){T(i,u)}else{l(u)}return o};x.prototype.done=function(e,t){var n=this;if(e||t){n=n.then(e,t)}n.then(null,d)};x.prototype.fail=function(e){return this.then(null,e)};x.prototype.spread=function(e,t){return this.then(e&&function(n){return M(n,[]).then(function(t){return s.call(e,void 0,t)},t)},t)};x.prototype.timeout=function(e,t){var n=this;var r=new x;if(n._state!==_){g(r,n._state,n._value)}else{var i=setTimeout(function(){g(r,y,new Error(t||"Timed out after "+e+" ms"))},e);T(n,function(){clearTimeout(i);g(r,n._state,n._value)})}return r};x.prototype.delay=function(e){var t=this;var n=new x;setTimeout(function(){j(n,t)},e);return n};x.prototype.inspect=function(){switch(this._state){case _:return{state:"pending"};case m:return{state:"fulfilled",value:this._value};case y:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}};function b(e){function t(t){return f(t)?e(t,[]):w(t).then(function(t){return e(t,[])})}t._=e;return t}w.allSettled=b(A);function A(e,t){var n=0;var r=new x;h(e,function(e,i){var o=w(e);if(o._state===_){++n;T(o,function(){t[i]=o.inspect();if(--n===0){g(r,m,t)}})}else{t[i]=o.inspect()}});if(n===0){g(r,m,t)}return r}w.all=b(M);function M(e,t){var n=0;var r=k();h(e,function(e,i){var o=w(e);if(o._state===m){t[i]=o._value}else{++n;o.then(function(e){t[i]=e;if(--n===0){r.resolve(t)}},r.reject)}});if(n===0){r.resolve(t)}return r.promise}w.promised=C;function C(e){return function(){return M([this,M(arguments,[])],[]).then(function(t){return s.apply(e,t)})}}w.onerror=null;w.nextTick=function(e){l(function(){try{e()}catch(t){setTimeout(function(){throw t},0)}})};return w});